# Kubernetes Odoo Deployment

A beginner-friendly project to deploy Odoo (an open-source business applications suite) on Kubernetes using KinD (Kubernetes in Docker).

## What is this project?

This project helps you:
- Set up a local Kubernetes environment using KinD (Kubernetes IN Docker)
- Deploy Odoo business applications in a production-like environment on your local machine
- Learn GitOps practices with FluxCD
- Understand container orchestration concepts in a practical way

If you're new to Kubernetes, this project provides a structured way to experiment with containerized applications without needing cloud resources.

## Prerequisites

- Docker
- Homebrew (for macOS users)
- kubectl
- KinD (Kubernetes in Docker)
- kustomize
- k9s (optional, for Kubernetes UI)
- flux (for GitOps)

Don't worry if you don't have these tools yet - the setup commands will help you install them!

## Before You Start

Understanding some basic terminology will be helpful as you work through this project.

### Essential Docker Terminology

*   **Image**: A read-only template with instructions for creating a Docker container. Think of it as a blueprint or a snapshot of an application and its environment.
*   **Container**: A runnable instance of an image. Containers are isolated environments that package up an application and its dependencies.
*   **Dockerfile**: A text document that contains all the commands a user could call on the command line to assemble an image.
*   **Docker Hub**: A cloud-based registry service that allows you to link to code repositories, build your images and test them, stores manually pushed images, and links to Docker Cloud so you can deploy images to your hosts.
*   **Volume**: A mechanism for persisting data generated by and used by Docker containers. Volumes are managed by Docker and are stored in a part of the host filesystem.
*   **Docker Compose**: A tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services.

### Essential Kubernetes Terminology

*   **Cluster**: A set of worker machines, called nodes, that run containerized applications. Every cluster has at least one worker node and a control plane.
*   **Node**: A worker machine in Kubernetes. It may be a VM or physical machine, depending on the cluster. Each node contains the services necessary to run Pods and is managed by the control plane.
*   **Control Plane**: Manages the worker nodes and the Pods in the cluster. Components include the API Server, etcd, Scheduler, and Controller Manager.
*   **Pod**: The smallest deployable unit in Kubernetes. A Pod represents a single instance of a running process in your cluster and can contain one or more containers (like Docker containers).
*   **Service**: An abstract way to expose an application running on a set of Pods as a network service. With Kubernetes you don't need to modify your application to use an unfamiliar service discovery mechanism.
*   **Deployment**: Provides declarative updates for Pods and ReplicaSets. You describe a desired state in a Deployment, and the Deployment Controller changes the actual state to the desired state at a controlled rate.
*   **ReplicaSet**: Ensures that a specified number of pod replicas are running at any given time.
*   **ConfigMap**: An API object used to store non-confidential data in key-value pairs. Pods can consume ConfigMaps as environment variables, command-line arguments, or as configuration files in a volume.
*   **Secret**: An object that stores sensitive data, such as passwords, OAuth tokens, and ssh keys.
*   **Namespace**: Provides a scope for names. Names of resources need to be unique within a namespace, but not across namespaces. They are a way to divide cluster resources between multiple users.
*   **kubectl**: The Kubernetes command-line tool, allows you to run commands against Kubernetes clusters.
*   **KinD (Kubernetes in Docker)**: A tool for running local Kubernetes clusters using Docker container "nodes". KinD was primarily designed for testing Kubernetes itself, but may be used for local development or CI.
*   **Manifest**: A specification of a Kubernetes API object in JSON or YAML format. A manifest tells Kubernetes how to create or manage a resource.

## Quick Start

1. Clone this repository:
   ```
   git clone <repository-url>
   cd k8s-odoo
   ```

2. Install required tools:
   ```
   make brew-setup-all
   ```

3. Create a complete environment (cluster, images, and FluxCD):
   ```
   make up
   ```

4. Check the cluster status:
   ```
   make kind-status
   ```

5. When you're finished, clean up:
   ```
   make down
   ```

## Understanding the Project Components

### Kubernetes in Docker (KinD)
KinD creates a Kubernetes cluster that runs inside Docker containers instead of VMs, making it lightweight and perfect for development.

### FluxCD
FluxCD is a GitOps tool that ensures your Kubernetes cluster matches the desired state defined in your Git repository. In this project, we use OCI artifacts instead of Git repositories.

### CloudNative PostgreSQL
This operator helps manage PostgreSQL databases in Kubernetes - essential for Odoo which needs a database.

### Local Registry
The project sets up a local Docker registry so you can push and pull images without needing access to public registries.

## Project Structure

```
k8s-odoo/
├── kubernetes/                  # Kubernetes manifests
│   ├── clusters/                # Cluster-specific configurations
│   ├── infra/                   # Infrastructure components (CRDs, HelmRepositories)
│   └── operators/               # Kubernetes operators (CloudNative PG)
├── scripts/                     # Make scripts for different components
│   ├── fluxcd.mk                # FluxCD setup and management
│   ├── images.mk                # Docker image management
│   ├── k8s.mk                   # Kubernetes/KinD cluster management
│   └── setup.mk                 # Development environment setup
└── Makefile                     # Main entry point for all operations
```

## Available Commands

Run `make help` to see all available commands.

### High-Level Commands
- `make up` - Create everything you need (cluster, registry, FluxCD)
- `make down` - Clean up all resources

### Kubernetes Commands

- `make kind-create` - Create a Kubernetes cluster using KIND
- `make kind-delete` - Delete the Kubernetes cluster
- `make kind-status` - Check status of the KIND cluster
- `make kind-load-image` - Load a Docker image into KIND (requires IMAGE=name:tag)

### Setup Commands

- `make brew-common` - Install required development tools
- `make brew-update-tools` - Update all installed tools
- `make brew-setup-all` - Install and update all tools

### FluxCD Commands

- `make fluxcd-setup` - Complete FluxCD setup
- `make fluxcd-push-artifacts` - Push manifests to OCI registry
- `make fluxcd-verify-artifacts` - Verify artifacts in registry

### Image Commands

- `make images-manage-all` - Pull and load all required Docker images
- `make images-pull-all` - Pull all required Docker images
- `make images-load-all` - Load all required Docker images into KinD

## How to Use This Project to Learn Kubernetes

1. **Start small**: Begin by exploring the basic KinD cluster setup
2. **Understand the Makefiles**: Look at how tasks are automated
3. **Study the manifests**: Check the YAML files in the kubernetes/ directory
4. **Watch FluxCD in action**: See how changes to manifests get automatically applied
5. **Try modifications**: Make small changes to see how they affect the system
6. **Follow the Tutorials**: Dive into the detailed guides in the `/tutorials` directory to understand Docker, Kubernetes, Helm, and FluxCD concepts step-by-step.

## Tutorials / Learning Resources

This project includes detailed, hands-on tutorials to guide you through the core technologies used:

*   **[Docker Workshop](./tutorials/01_docker.md)**: From Zero to Container Hero.
*   **[Kubernetes Workshop](./tutorials/02_kubernetes.md)**: From Container to Cloud Native.
*   **[Helm Workshop](./tutorials/03_helm.md)**: Managing Kubernetes Applications.
*   **[FluxCD Workshop](./tutorials/04_fluxcd.md)**: GitOps for Kubernetes.
*   **[CloudnativePG Workshop](./tutorials/05_cloudnativepg.md)**: Running PostgreSQL in Kubernetes.

These tutorials are designed to complement the project setup and provide a deeper understanding of each component.

## Common Issues and Solutions

- **Images not found**: Run `make images-manage-all` to ensure all images are pulled and loaded
- **FluxCD not syncing**: Check with `kubectl get kustomizations -n flux-system` and look at events
- **Pods pending**: Use `kubectl describe pod <pod-name>` to see what's wrong
- **Registry issues**: Ensure the registry container is running with `docker ps | grep kind-registry`

## Configuration

The default configuration is set in the Makefiles. Key variables:

- `KIND_IMAGE`: The KIND node image version (default: kindest/node:v1.33.0)
- `KIND_CLUSTER`: The name of the KinD cluster (default: starter-cluster)
- `WAIT_TIMEOUT`: Timeout for waiting on Kubernetes resources (default: 120s)

## Next Steps After You're Comfortable

- Try deploying your own applications alongside Odoo
- Modify the Odoo configuration for different business needs
- Experiment with scaling components
- Add monitoring with Prometheus (already included in the CRDs)

